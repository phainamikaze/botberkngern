const sendApi = require('./send');
const Lists = require('./lists');

const sendOwnedLists = async (senderId, type) => {
  try{
    const lists = await Lists.getOwnedForUser(senderId);
    await sendApi.sendLists(senderId, type, lists, Number(type.substring(19)));
    return;
  }catch(e){
    return;
  }
};

const sendSharedLists = (senderId, type) => {
  Lists.getSharedToUser(senderId)
    .then((lists) => {
      sendApi.sendLists(senderId, type, lists, Number(type.substring(22)));
    });
};

const handleReceivePostback =async (event) => {
  const type = event.postback.payload;
  const senderId = event.sender.id;

  if (type.substring(0, 11) === 'owned_lists') {
    await sendOwnedLists(senderId, type);
    return;
  }else{
    return;
  }
  // } else if (type.substring(0, 16) === 'subscribed_lists') {
  //   sendSharedLists(senderId, type);
  // } else if (type.substring(0, 11) === 'get_started') {
  //   sendApi.sendWelcomeMessage(senderId);
  //   return;
  // }

  // sendApi.sendMessage(senderId, `Unknown Postback called: ${type}`);
};

module.exports = {
  handleReceivePostback
};
